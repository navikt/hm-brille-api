apiVersion: nais.io/v1
kind: Naisjob
metadata:
  name: hm-brille-api-job-sync-tss
  namespace: teamdigihot
  labels:
    team: teamdigihot
spec:
  restartPolicy: Never
  image: {{ image }}
  env:
  {{#each env}}
    - name: {{@key}}
      value: "{{this}}"
  {{/each}}
    - name: GIT_COMMIT
      value: {{commit}}
    - name: CRONJOB_TYPE
      value: SYNC_TSS
  envFrom:
    - secret: redis-password
    - secret: hm-soknad-api-secret
    - secret: hm-slack-hook
    - secret: google-sql-hm-brille-api-brilleapidb-naisjob-0cb211b2
    # - secret: hm-brille-api-naisjob-db
  azure:
    application:
      enabled: true
  kafka:
    pool: {{ kafka-cluster }}
  secureLogs:
    enabled: true
  gcp:
    permissions:
      - resource:
          apiVersion: resourcemanager.cnrm.cloud.google.com/v1beta1
          kind: Project
        role: roles/cloudsql.client